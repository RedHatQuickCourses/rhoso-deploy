<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Preparing RHOCP for RHOSP Network Isolation :: RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</title>
    <link rel="prev" href="section3.html">
    <link rel="next" href="section5.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/changeme/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rhods-deploy" data-version="1.34">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section0.html">Traditional TripleO deployment verses deployment with OpenShift cluster.</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section1.html">RHOSO installation process overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section2.html">Perform Prerequisite Operations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section3.html">Install the OpenStack Operator</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="section4.html">Preparing RHOCP for RHOSP Network Isolation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section5.html">Create the OpenStack Control Plane</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section6.html">Verify OpenStack Controlplane configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section7.html">Create the Data Plane</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section8.html">Verify Dataplane deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section9.html">Access OpenStack</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</span>
    <span class="version">1.34</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.34</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a></li>
    <li><a href="section4.html">Preparing RHOCP for RHOSP Network Isolation</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Preparing RHOCP for RHOSP Network Isolation</h1>
<div class="paragraph">
<p>Network confiuration for the nodes is facilated by the below operators.</p>
</div>
<div class="paragraph">
<p>NMState operator - facilitates network configuration for the nodes of the cluster.
Multus CNI plugin - facilitates the network configuration for the pods running controlplane services for the cluster.
MetalLB operator - offers load blaancing service for OCP baremetal cluster.</p>
</div>
<div class="paragraph">
<p>FIXME: review the explanation, short version above or elaborated as below.</p>
</div>
<div class="paragraph">
<p><code>NodeNetworkConfigurationPolicy</code> offered by nmstate operator allows you to configure network settings on individual nodes in a network.
This policy can be used to set network interfaces, routing tables, firewall rules, and other network-related settings.</p>
</div>
<div class="paragraph">
<p>NetworkAttachmentDefinition (NAD) is a feature offered by the Multus CNI (Container Network Interface) plugin.
NAD is used to define network attachment points and states for network devices, allowing for automatic fencing and management of those devices.</p>
</div>
<div class="paragraph">
<p><code>IPAddressPool</code> and <code>L2Advertisement</code> CRs offered by MetalLB operator facilitates IP advertisement from specified pools, ensuring efficient IP allocation to services and namespaces.
By leveraging these custom resources, OpenShift facilitates efficient communication between nodes within the cluster, promoting seamless integration and performance optimization in networking-intensive environments.</p>
</div>
<div class="paragraph">
<p>Please refer to the following table for the network configuration utilized in this deployment:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Network name</th>
<th class="tableblock halign-left valign-top">VLAN</th>
<th class="tableblock halign-left valign-top">CIDR</th>
<th class="tableblock halign-left valign-top">NetConfig allocation</th>
<th class="tableblock halign-left valign-top">Range	MetalLB IPAddressPool range</th>
<th class="tableblock halign-left valign-top">nad ipam range</th>
<th class="tableblock halign-left valign-top">OCP worker nncp range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ctlplane</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.22.0.0/24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.22.0.100 - 172.22.0.120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.22.0.80-172.22.0.90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.22.0.30 - 172.22.0.70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.22.0.10 - 172.22.0.20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">internalapi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.17.0.0/24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.17.0.100 - 172.17.0.250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.17.0.80-172.17.0.90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.17.0.30 - 172.17.0.70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.17.0.10 - 172.17.0.20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.18.0.0/24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.18.0.100 - 172.18.0.250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.18.0.80-172.18.0.90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.18.0.30 - 172.18.0.70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.18.0.10 - 172.18.0.20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.19.0.0/24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.19.0.100 - 172.19.0.250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.19.0.80-172.19.0.90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.19.0.30 - 172.19.0.70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.19.0.10 - 172.19.0.20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">192.168.123.0/24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">192.168.123.61 - 192.168.123.90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">192.168.122.80 - 192.168.122.90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">192.168.123.60 - 192.168.123.110</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We will be using a preconfigured set of yaml files in the <code>files</code> directory which start with <code>osp-ng-nncp-</code>.</p>
</div>
<div class="paragraph">
<p>FIXME: mention source of these files and a few guidelines to twek these as per the lab infrastructure.</p>
</div>
<div class="paragraph">
<p>There are 3 files for each of the control plane and worker nodes.</p>
</div>
<div class="paragraph">
<p>Change to the <code>files</code> directory:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/labrepo/content/files</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Apply preconfigured yamls indivdually:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f osp-ng-nncp-w1.yaml
oc apply -f osp-ng-nncp-w2.yaml
oc apply -f osp-ng-nncp-w3.yaml
oc apply -f osp-ng-nncp-m1.yaml
oc apply -f osp-ng-nncp-m2.yaml
oc apply -f osp-ng-nncp-m3.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Wait until they are in an available state before proceeding:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get nncp -w</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                              STATUS      REASON
osp-enp1s0-master1-ocp4-master1   Available   SuccessfullyConfigured
osp-enp1s0-master2-ocp4-master2   Available   SuccessfullyConfigured
osp-enp1s0-master3-ocp4-master3   Available   SuccessfullyConfigured
osp-enp1s0-worker-ocp4-worker1    Available   SuccessfullyConfigured
osp-enp1s0-worker-ocp4-worker2    Available   SuccessfullyConfigured
osp-enp1s0-worker-ocp4-worker3    Available   SuccessfullyConfigured</code></pre>
</div>
</div>
</li>
<li>
<p>Before proceeding configure a <strong>nad</strong> resource for each isolated network to attach a service pod to the network:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f osp-ng-netattach.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the <code>network-attachment-definations</code> created with the above command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get network-attachment-definitions.k8s.cni.cncf.io -n openstack</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre>NAME          AGE
ctlplane      5s
external      5s
internalapi   5s
storage       5s
tenant        5s</pre>
</div>
</div>
</li>
<li>
<p>Once the nodes are available and attached &lt;&lt; FIXME elaborate configure the <strong>MetalLB IP address range</strong> using a preconfigured yaml file:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f osp-ng-metal-lb-ip-address-pools.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>FIXME: what is the difference in the range mentioned in NAD whereabbouts v/s metallb ipaddresspools</p>
</div>
</li>
<li>
<p>Verify the metallb ip address pools using below command:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get ipaddresspools.metallb.io -n metallb-system</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre>NAME          AUTO ASSIGN   AVOID BUGGY IPS   ADDRESSES
ctlplane      true          false             ["172.22.0.80-172.22.0.90"]
internalapi   true          false             ["172.17.0.80-172.17.0.90"]
storage       true          false             ["172.18.0.80-172.18.0.90"]
tenant        true          false             ["172.19.0.80-172.19.0.90"]</pre>
</div>
</div>
</li>
<li>
<p>Lastly, configure a <strong>L2Advertisement</strong> resource which will define which node advertises a service to the local network which has been preconfigured for your lab environment:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f osp-ng-metal-lb-l2-advertisements.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the configuration:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get l2advertisements.metallb.io -n metallb-system</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>NAME          IPADDRESSPOOLS    IPADDRESSPOOL SELECTORS   INTERFACES
ctlplane      ["ctlplane"]                                ["enp1s0"]
internalapi   ["internalapi"]                             ["enp1s0.20"]
storage       ["storage"]                                 ["enp1s0.21"]
tenant        ["tenant"]                                  ["enp1s0.22"]</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>FIXME: Any explanation about the significance of these?</p>
</div>
<nav class="pagination">
  <span class="prev"><a href="section3.html">Install the OpenStack Operator</a></span>
  <span class="next"><a href="section5.html">Create the OpenStack Control Plane</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
